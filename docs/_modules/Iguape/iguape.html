

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Iguape.iguape &mdash; Iguape - Paineira Graphical User Interface 1.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/theme_overrides.css" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=fc837d61"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Iguape - Paineira Graphical User Interface
              <img src="../../_static/Logo_IGUAPE.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#linux-and-macos">Linux and macOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#windows">Windows</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">iguape</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Iguape.html">Iguape package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../Iguape.html#subpackages">Subpackages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../Iguape.GUI.html">Iguape.GUI package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../Iguape.html#submodules">Submodules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Iguape.html#module-Iguape.Monitor">Iguape.Monitor module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../Iguape.html#Iguape.Monitor.FolderMonitor"><code class="docutils literal notranslate"><span class="pre">FolderMonitor</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Iguape.html#Iguape.Monitor.counter"><code class="docutils literal notranslate"><span class="pre">counter()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Iguape.html#Iguape.Monitor.data_read"><code class="docutils literal notranslate"><span class="pre">data_read()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Iguape.html#Iguape.Monitor.peak_fit"><code class="docutils literal notranslate"><span class="pre">peak_fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Iguape.html#Iguape.Monitor.peak_fit_split_gaussian"><code class="docutils literal notranslate"><span class="pre">peak_fit_split_gaussian()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Iguape.html#Iguape.Monitor.pseudo_voigt"><code class="docutils literal notranslate"><span class="pre">pseudo_voigt()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Iguape.html#Iguape.Monitor.split_pseudo_voigt"><code class="docutils literal notranslate"><span class="pre">split_pseudo_voigt()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../Iguape.html#module-Iguape.iguape">Iguape.iguape module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../Iguape.html#Iguape.iguape.FitWindow"><code class="docutils literal notranslate"><span class="pre">FitWindow</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Iguape.html#Iguape.iguape.Window"><code class="docutils literal notranslate"><span class="pre">Window</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Iguape.html#Iguape.iguape.Worker"><code class="docutils literal notranslate"><span class="pre">Worker</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../Iguape.html#module-Iguape.launcher">Iguape.launcher module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../Iguape.html#Iguape.launcher.main"><code class="docutils literal notranslate"><span class="pre">main()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../Iguape.html#module-Iguape">Module contents</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Iguape - Paineira Graphical User Interface</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">Iguape.iguape</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for Iguape.iguape</h1><div class="highlight"><pre>
<span></span><span class="c1">#This is part of the source code for the Paineira Graphical User Interface - Iguape</span>
<span class="c1">#The code is distributed under the GNU GPL-3.0 License. Please refer to the main page (https://github.com/cnpem/iguape) for more information</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This is the main script for the excution of the Paineira Graphical User Interface, a GUI for visualization and data processing during in situ experiments at Paineira.</span>
<span class="sd">In this script, both GUIs used by the program are called and all of the backend functions and processes are defined. </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span><span class="o">,</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt5.QtWidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">QApplication</span><span class="p">,</span> <span class="n">QVBoxLayout</span><span class="p">,</span> <span class="n">QFileDialog</span><span class="p">,</span> <span class="n">QDialog</span><span class="p">,</span> <span class="n">QProgressDialog</span><span class="p">,</span> <span class="n">QPushButton</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt5.QtCore</span><span class="w"> </span><span class="kn">import</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QSize</span><span class="p">,</span> <span class="n">QThread</span><span class="p">,</span> <span class="n">pyqtSignal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.backends.backend_qt5agg</span><span class="w"> </span><span class="kn">import</span> <span class="n">FigureCanvasQTAgg</span> <span class="k">as</span> <span class="n">FigureCanvas</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.backends.backend_qt5agg</span><span class="w"> </span><span class="kn">import</span> <span class="n">NavigationToolbar2QT</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.figure</span><span class="w"> </span><span class="kn">import</span> <span class="n">Figure</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.lines</span><span class="w"> </span><span class="kn">import</span> <span class="n">Line2D</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.widgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">SpanSelector</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.cm</span><span class="w"> </span><span class="kn">import</span> <span class="n">ScalarMappable</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt5.QtWidgets</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">QApplication</span><span class="p">,</span> <span class="n">QDialog</span><span class="p">,</span> <span class="n">QMainWindow</span><span class="p">,</span> <span class="n">QMessageBox</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Monitor</span><span class="w"> </span><span class="kn">import</span> <span class="n">FolderMonitor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">GUI.iguape_GUI</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ui_MainWindow</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">GUI.pk_window</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ui_pk_window</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Monitor</span><span class="w"> </span><span class="kn">import</span> <span class="n">peak_fit</span><span class="p">,</span> <span class="n">counter</span><span class="p">,</span> <span class="n">peak_fit_split_gaussian</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt5.QtCore</span><span class="w"> </span><span class="kn">import</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QThread</span><span class="p">,</span> <span class="n">pyqtSignal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt5.QtWidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">QProgressDialog</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="p">,</span> <span class="n">QVBoxLayout</span>

<span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s1">&#39;frozen&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span> 
    <span class="kn">import</span><span class="w"> </span><span class="nn">pyi_splash</span> <span class="c1">#If the program is executed as a pyinstaller executable, import pyi_splash for the Splash Screen</span>

<span class="n">license</span>  <span class="o">=</span> <span class="s1">&#39;GNU GPL-3.0 License&#39;</span>
    
<span class="n">counter</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="Window">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Window</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">,</span> <span class="n">Ui_MainWindow</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Main window Class</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_graphs_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s1">&#39;frozen&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">pyi_splash</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1">#After the GUI initialization, close the Splash Screen</span>

<div class="viewcode-block" id="Window.create_graphs_layout">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window.create_graphs_layout">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_graphs_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Routine to create the layout for the XRD and Fitting Data Graphs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">XRD_data_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="c1"># Creating the main Figure and Layout #</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_main</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gs_main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_main</span><span class="o">.</span><span class="n">add_gridspec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_main</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gs_main</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_main</span><span class="o">.</span><span class="n">set_layout_engine</span><span class="p">(</span><span class="s1">&#39;compressed&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas_main</span> <span class="o">=</span> <span class="n">FigureCanvas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_main</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">XRD_data_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas_main</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">XRD_data_tab</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">XRD_data_layout</span><span class="p">)</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">peak_fit_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="c1">#Creating the fitting parameter Figure and Layout#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_sub</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gs_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_sub</span><span class="o">.</span><span class="n">add_gridspec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_2theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_sub</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gs_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_sub</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gs_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_FWHM</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_sub</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gs_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_sub</span><span class="o">.</span><span class="n">set_layout_engine</span><span class="p">(</span><span class="s1">&#39;compressed&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas_sub</span> <span class="o">=</span> <span class="n">FigureCanvas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_sub</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peak_fit_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas_sub</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peak_fit_tab</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peak_fit_layout</span><span class="p">)</span>

        <span class="c1">#Creating a colormap on the main canvas#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Initial placeholder values for norm #</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sm</span> <span class="o">=</span> <span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_main</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_main</span><span class="p">)</span> <span class="c1"># Creating the colorbar axes #</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cax_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_sub</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_area</span><span class="p">)</span> <span class="c1"># Creating the colorbar axes #</span>
        <span class="c1">#Connecting functions to buttons#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_graphs</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_interval</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">peak_fit_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_fit_interval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_peak_fit_data_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_data_frame</span><span class="p">)</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_with_temp</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_interval</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_interval</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">folder_selected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_mask_signal</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="c1">#Create span selector on the main plot#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">span</span> <span class="o">=</span> <span class="n">SpanSelector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_main</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onselect</span><span class="p">,</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">useblit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">props</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">capstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">peak_fit_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">NavigationToolbar2QT</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas_sub</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span> <span class="o">=</span> <span class="n">NavigationToolbar2QT</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas_main</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">XRD_data_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas_main</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s2">&quot;motion_notify_event&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_mouse_move</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">actionOpen_New_Folder</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_folder</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionAbout</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">about</span><span class="p">)</span>
        
        

        <span class="bp">self</span><span class="o">.</span><span class="n">offset_slider</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset_slider</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mi">99</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>

    
        <span class="bp">self</span><span class="o">.</span><span class="n">XRD_measure_order_checkbox</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_order_index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature_checkbox</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">apply_temp_mask</span><span class="p">)</span></div>


<div class="viewcode-block" id="Window.update_graphs">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window.update_graphs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_graphs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears plotted axis, updates the colormap normalization and calls refreshing routines (_update_main_figure and _plot_fitting_parameters)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">QApplication</span><span class="o">.</span><span class="n">setOverrideCursor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">WaitCursor</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ax_main</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_main_figure</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot_fitting_parameters</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">canvas_main</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas_sub</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cax</span><span class="o">.</span><span class="n">update_normal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sm</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cax_2</span><span class="o">.</span><span class="n">update_normal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sm</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Please, initialize the monitor! Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;Please initialize the monitor!&#39;</span><span class="p">)</span> 
            <span class="k">pass</span>

        <span class="n">QApplication</span><span class="o">.</span><span class="n">restoreOverrideCursor</span><span class="p">()</span></div>

        

<div class="viewcode-block" id="Window._get_mask">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window._get_mask">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a mask, based on the interval selected by the user, for the i-th XRD measure.</span>
<span class="sd">        If no interval is selected, returns None.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            i (int): Index of the XRD measure</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            slice: Slice object for the mask</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_interval</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="Window.update_colormap">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window.update_colormap">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_colormap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color_map_type</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Updates the colormap based on the selected color map type (temperature or XRD measure order)</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">                color_map_type (str): Type of colormap to be used</span>
<span class="sd">                label (str): Label for the colorbar</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">vmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">vmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="n">color_map_type</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="n">color_map_type</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">set_norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cax</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cax_2</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="p">)</span></div>


<div class="viewcode-block" id="Window._update_main_figure">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window._update_main_figure">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_update_main_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Main Figure (XRD Data) refreshing routine. It plots the XRD patterns, with the customizations selected by the user (2theta mask, temperature mask, XRD index, etc.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_mask</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_mask_signal</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">data_frame</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">IndexingError</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_with_temp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_colormap</span><span class="p">(</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="s1">&#39;Cryojet Temperature (K)&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">kelvin_sginal</span> <span class="k">else</span> <span class="s1">&#39;Temperature (°C)&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_temp_doubleSpinBox</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_temp_doubleSpinBox_2</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_temp_doubleSpinBox</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_temp_doubleSpinBox_2</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_colormap</span><span class="p">(</span><span class="s1">&#39;file_index&#39;</span><span class="p">,</span> <span class="s1">&#39;XRD acquisition time&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_temp_doubleSpinBox</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;file_index&#39;</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;file_index&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_temp_doubleSpinBox_2</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;file_index&#39;</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;file_index&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_temp_doubleSpinBox</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;file_index&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_temp_doubleSpinBox_2</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;file_index&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_slider</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">])):</span>
            <span class="n">norm_col</span> <span class="o">=</span> <span class="s1">&#39;temp&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_with_temp</span> <span class="k">else</span> <span class="s1">&#39;file_index&#39;</span> <span class="c1">#Flag for chosing the XRD pattern index</span>
            <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="n">norm_col</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span> <span class="c1">#Selecting the pattern&#39;s color based on the colormap</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_mask</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax_main</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">mask</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;XRD pattern #</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s2">&quot;file_index&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> - Temperature </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s2">&quot;temp&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> K&#39;</span> 
                                                                                                                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">kelvin_sginal</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;XRD pattern #</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s2">&quot;file_index&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> - Temperature </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s2">&quot;temp&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> °C&#39;</span> 
                                                                                                                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_with_temp</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;XRD pattern #</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s2">&quot;file_index&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">offset</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax_main</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;2θ (°)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_main</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity (a.u.)&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Window._plot_fitting_parameters">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window._plot_fitting_parameters">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_plot_fitting_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls the fitting parameters plotting routines (_plot_single_peak or _plot_double_peak) </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_interval</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax_2theta</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_area</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_FWHM</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_interval_window</span><span class="o">.</span><span class="n">fit_model</span> <span class="o">==</span> <span class="s1">&#39;PseudoVoigt&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot_single_peak</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot_double_peak</span><span class="p">()</span>

    
        <span class="n">avxspan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax_main</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Selected Fitting Interval&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_main</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">avxspan</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="Window._plot_single_peak">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window._plot_single_peak">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_plot_single_peak</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Based on the x data type flag (temperature/XRD measure order), plots the fitting parameters (Peak Postion, Integrated Area and FWHM) as a function of x.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_data_type</span> <span class="o">=</span> <span class="s1">&#39;temp&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_with_temp</span> <span class="k">else</span> <span class="s1">&#39;file_index&#39;</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="s1">&#39;XRD measure&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_with_temp</span> <span class="k">else</span> <span class="s1">&#39;Cryojet Temperature (K)&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">kelvin_sginal</span> <span class="k">else</span> <span class="s1">&#39;Temperature (°C)&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot_parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_2theta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="n">x_data_type</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;dois_theta_0&#39;</span><span class="p">],</span> <span class="s1">&#39;Peak position (°)&#39;</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot_parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_area</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="n">x_data_type</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">],</span> <span class="s1">&#39;Peak integrated area&#39;</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot_parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_FWHM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="n">x_data_type</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;fwhm&#39;</span><span class="p">],</span> <span class="s1">&#39;FWHM (°)&#39;</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Window._plot_double_peak">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window._plot_double_peak">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_plot_double_peak</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Based on the x data type flag (temperature/XRD measure order), plots the fitting parameters (Peak Postion, Integrated Area and FWHM) as a function of x. In this version, the fitting model is the Split Pseudo-Voigt Model (2x Pseudo-Voigt)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_data_type</span> <span class="o">=</span> <span class="s1">&#39;temp&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_with_temp</span> <span class="k">else</span> <span class="s1">&#39;file_index&#39;</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="s1">&#39;Cryojet Temperature (K)&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">kelvin_sginal</span> <span class="k">else</span> <span class="s1">&#39;Temperature (°C)&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_with_temp</span> <span class="k">else</span> <span class="s1">&#39;XRD measure&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_plot_parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_2theta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="n">x_data_type</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;dois_theta_0&#39;</span><span class="p">],</span> <span class="s1">&#39;Peak position (°)&#39;</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot_parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_2theta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="n">x_data_type</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;dois_theta_0_#2&#39;</span><span class="p">],</span> <span class="s1">&#39;Peak position (°)&#39;</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_plot_parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_area</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="n">x_data_type</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">],</span> <span class="s1">&#39;Peak integrated area&#39;</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot_parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_area</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="n">x_data_type</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;area_#2&#39;</span><span class="p">],</span> <span class="s1">&#39;Peak integrated area&#39;</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_plot_parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_FWHM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="n">x_data_type</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;fwhm&#39;</span><span class="p">],</span> <span class="s1">&#39;FWHM (°)&#39;</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot_parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_FWHM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="n">x_data_type</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;fwhm_#2&#39;</span><span class="p">],</span> <span class="s1">&#39;FWHM (°)&#39;</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Window._plot_parameter">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window._plot_parameter">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_plot_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Routine for plotting x and y on given axis (ax)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
            <span class="n">norm_col</span> <span class="o">=</span> <span class="s1">&#39;temp&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_with_temp</span> <span class="k">else</span> <span class="s1">&#39;file_index&#39;</span>
            <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="n">norm_col</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">marker</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
            <span class="n">peak1</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;PseudoVoigt #1&#39;</span><span class="p">)</span>
            <span class="n">peak2</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;PseudoVoigt #2&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span> <span class="o">=</span> <span class="p">[</span><span class="n">peak1</span><span class="p">,</span> <span class="n">peak2</span><span class="p">])</span></div>


<div class="viewcode-block" id="Window.select_folder">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window.select_folder">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">select_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Routine for selecting the folder to be monitored. It creates a FolderMonitor object and starts the monitoring process.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_selected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">data_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">counter</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_with_temp</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_interval</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_interval</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">folder_selected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_mask_signal</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">folder_path</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getExistingDirectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Select the data folder to monitor&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">Options</span><span class="p">())</span> <span class="c1"># Selection of monitoring folder</span>
        <span class="k">if</span> <span class="n">folder_path</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">folder_selected</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span> <span class="o">=</span> <span class="n">FolderMonitor</span><span class="p">(</span><span class="n">folder_path</span><span class="o">=</span><span class="n">folder_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">new_data_signal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_new_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No folder selected. Exiting&#39;</span><span class="p">)</span></div>

            

<div class="viewcode-block" id="Window.handle_new_data">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window.handle_new_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">handle_new_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles new data received from the FolderMonitor object. It updates the plot_data DataFrame and calls the update_graphs routine.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            new_data (DataFrame): New data received from the FolderMonitor object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">,</span> <span class="n">new_data</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="Window.onselect">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window.onselect">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">onselect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Routine for selecting the fitting interval. It updates the selected_interval attribute and calls the update_graphs routine.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            xmin (float): Minimum x value of the selected interval</span>
<span class="sd">            xmax (float): Maximum x value of the selected interval</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_interval</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
        <span class="c1">#print(f&#39;Selected Interval: {self.selected_interval}&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_graphs</span><span class="p">()</span></div>

    <span class="c1"># Reset button function #     </span>
<div class="viewcode-block" id="Window.reset_interval">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window.reset_interval">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">reset_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Routine for resetting the selected interval. It sets the selected_interval attribute to None and calls the update_graphs routine.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_interval</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_graphs</span><span class="p">()</span></div>

    <span class="c1"># Peak fit interval selection routine # </span>
<div class="viewcode-block" id="Window.select_fit_interval">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window.select_fit_interval">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">select_fit_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Routine for selecting the fitting interval. It checks if the monitor has been initialized and calls the FitWindow object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_selected</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;Please initialize the monitor!&#39;</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No data available. Wait for the first measure!&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ax_2theta</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ax_area</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ax_FWHM</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fit_interval</span><span class="o">=</span><span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#Reset fitting data</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fit_interval_window</span> <span class="o">=</span> <span class="n">FitWindow</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fit_interval_window</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Please, push the Refresh Button! Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;Please, push the Refresh Button!&#39;</span><span class="p">)</span> 
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Window.on_mouse_move">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window.on_mouse_move">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_mouse_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tracks the mouse motion and updates the toolbar with the event information.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            event (MouseEvent): Mouse event. Inherited from matplotlib.backend_bases.MouseEvent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas_main</span><span class="o">.</span><span class="n">mouse_event</span> <span class="o">=</span> <span class="n">event</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>
        <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">min_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="c1">#float(&#39;inf&#39;)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Iterate over all lines in the plot, fiding the closest line point to the mouse. </span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas_main</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_lines</span><span class="p">():</span>
                <span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">get_xdata</span><span class="p">(),</span> <span class="n">line</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                   <span class="c1">#Find the closest point to the mouse on the line</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x_data</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_data</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
                    <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x_data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="c1">#print(f&#39;Distance: {dist}&#39;, f&#39;X_curve: {x_data[idx]}&#39;, f&#39;Y_Curve: {y_data[idx]}&#39;, f&#39;X_mouse: {x}&#39;, f&#39;Y_mouse: {y}&#39;)</span>
                    <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">min_dist</span><span class="p">:</span>
                        <span class="n">min_dist</span> <span class="o">=</span> <span class="n">dist</span> 
                        <span class="n">label</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span>
        
        <span class="c1">#print(f&#39;Distance: {dist}&#39;, f&#39;X_curve: {x_data[idx]}&#39;, f&#39;Y_Curve: {y_data[idx]}&#39;, f&#39;X_mouse: {x}&#39;, f&#39;Y_mouse: {y}&#39;, f&#39;Cruve label: {label}&#39;)</span>
                            
        <span class="c1">#print(label)</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Label: </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> | 2theta=</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, Intensity=</span><span class="si">{</span><span class="n">y</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">set_message</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;2theta=</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, Intensity=</span><span class="si">{</span><span class="n">y</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">set_message</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">set_message</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="Window.save_data_frame">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window.save_data_frame">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the fitting data to a CSV file. The user is prompted to select the file path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">Options</span><span class="p">()</span>

        <span class="c1"># Select appropriate DataFrame generator based on model and temperature</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_interval_window</span><span class="o">.</span><span class="n">fit_model</span> <span class="o">==</span> <span class="s1">&#39;PseudoVoigt&#39;</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_single_peak_dataframe</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_double_peak_dataframe</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_path</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Save fitting Data&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;CSV (*.csv);;All Files (*)&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">file_path</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No data available! Please, initialize the monitor! Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;Please initialize the monitor!&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exception </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1"> encountered&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Window._create_single_peak_dataframe">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window._create_single_peak_dataframe">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_create_single_peak_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a DataFrame with the fitting data for the PseudoVoigt model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            DataFrame: DataFrame with the fitting data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_with_temp</span><span class="p">:</span>
            <span class="n">temp_label</span> <span class="o">=</span> <span class="s1">&#39;Cryojet Temperature (K)&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">kelvin_sginal</span> <span class="k">else</span> <span class="s1">&#39;Temperature (°C)&#39;</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="n">temp_label</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">],</span>
            <span class="s1">&#39;Peak position (degree)&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;dois_theta_0&#39;</span><span class="p">],</span>
            <span class="s1">&#39;Peak Integrated Area&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">],</span>
            <span class="s1">&#39;FWHM (degree)&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;fwhm&#39;</span><span class="p">],</span>
            <span class="s1">&#39;R-squared (R²)&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;R-squared&#39;</span><span class="p">]</span>
        <span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s1">&#39;Measure&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;file_index&#39;</span><span class="p">],</span>
            <span class="s1">&#39;Peak position (degree)&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;dois_theta_0&#39;</span><span class="p">],</span>
            <span class="s1">&#39;Peak Integrated Area&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">],</span>
            <span class="s1">&#39;FWHM (degree)&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;fwhm&#39;</span><span class="p">],</span>
            <span class="s1">&#39;R-squared (R²)&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;R-squared&#39;</span><span class="p">]</span>
        <span class="p">})</span></div>


<div class="viewcode-block" id="Window._create_double_peak_dataframe">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window._create_double_peak_dataframe">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_create_double_peak_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a DataFrame with the fitting data for the Split PseudoVoigt model (2x PseudoVoigt).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            DataFrame: DataFrame with the fitting data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_with_temp</span><span class="p">:</span>
            <span class="n">temp_label</span> <span class="o">=</span> <span class="s1">&#39;Cryojet Temperature (K)&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">kelvin_sginal</span> <span class="k">else</span> <span class="s1">&#39;Temperature (°C)&#39;</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="n">temp_label</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">],</span>
            <span class="s1">&#39;Peak position #1 (degree)&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;dois_theta_0&#39;</span><span class="p">],</span>
            <span class="s1">&#39;Peak Integrated Area #1&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">],</span>
            <span class="s1">&#39;FWHM (degree) #1&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;fwhm&#39;</span><span class="p">],</span>
            <span class="s1">&#39;Peak Position #2 (degree)&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;dois_theta_0_#2&#39;</span><span class="p">],</span>
            <span class="s1">&#39;Peak Integrated Area #2&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;area_#2&#39;</span><span class="p">],</span>
            <span class="s1">&#39;FWHM #2 (degree)&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;fwhm_#2&#39;</span><span class="p">],</span>
            <span class="s1">&#39;R-squared (R²)&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;R-squared&#39;</span><span class="p">]</span>
        <span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s1">&#39;Measure&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;file_index&#39;</span><span class="p">],</span>
            <span class="s1">&#39;Peak position #1 (degree)&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;dois_theta_0&#39;</span><span class="p">],</span>
            <span class="s1">&#39;Peak Integrated Area #1&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">],</span>
            <span class="s1">&#39;FWHM (degree) #1&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;fwhm&#39;</span><span class="p">],</span>
            <span class="s1">&#39;Peak Position #2 (degree)&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;dois_theta_0_#2&#39;</span><span class="p">],</span>
            <span class="s1">&#39;Peak Integrated Area #2&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;area_#2&#39;</span><span class="p">],</span>
            <span class="s1">&#39;FWHM #2 (degree)&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;fwhm_#2&#39;</span><span class="p">],</span>
            <span class="s1">&#39;R-squared (R²)&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;R-squared&#39;</span><span class="p">]</span>
        <span class="p">})</span></div>


<div class="viewcode-block" id="Window.validate_temp">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window.validate_temp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_temp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates the temperature selected at the SpinBoxes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            min_value (float): Minimum temperature value</span>
<span class="sd">            max_value (float): Maximum temperature value</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            tuple: Tuple with the minimum and maximum temperature values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">min_temp</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">min_value</span><span class="p">))</span>
        <span class="n">max_temp</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">max_value</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">min_temp</span><span class="p">,</span> <span class="n">max_temp</span></div>

    
<div class="viewcode-block" id="Window.apply_temp_mask">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window.apply_temp_mask">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_temp_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies the temperature mask to the data. It validates the temperature selected at the SpinBoxes and updates the plot_data DataFrame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_with_temp</span><span class="p">:</span>
                <span class="n">min_temp</span><span class="p">,</span> <span class="n">max_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_temp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_temp_doubleSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_temp_doubleSpinBox_2</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">temp_mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_temp</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">max_temp</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">temp_mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;file_index&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_temp_doubleSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;file_index&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_temp_doubleSpinBox_2</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temp_mask_signal</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_graphs</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No data available! Please, initialize the monitor! Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;Please initialize the monitor!&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exception </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1"> encountered&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Window.measure_order_index">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window.measure_order_index">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">measure_order_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checked</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Routine for selecting the XRD measure order index. It updates the plot_with_temp flag and calls the update_graphs routine.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            checked (bool): Flag for the XRD measure order index checkbox</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">checked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temperature_checkbox</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_with_temp</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_filter_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&lt;u&gt;Minimum:&lt;/u&gt;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_filter_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&lt;u&gt;Maximum:&lt;/u&gt;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_graphs</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temperature_checkbox</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="Window.temp_index">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window.temp_index">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">temp_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checked</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Routine for selecting the temperature index. It updates the plot_with_temp flag and calls the update_graphs routine.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            checked (bool): Flag for the temperature index checkbox</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">checked</span><span class="p">:</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">XRD_measure_order_checkbox</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_with_temp</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">min_filter_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&lt;u&gt;Minimum Temperature:&lt;/u&gt;&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_filter_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&lt;u&gt;Maximum Temperature:&lt;/u&gt;&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_graphs</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This experiment doesn&#39;t make use of temperature!&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">temperature_checkbox</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
                
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temperature_checkbox</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Please initizalie the Monitor! Error </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;Please initialize the monitor!&#39;</span><span class="p">)</span>     </div>

            
        
<div class="viewcode-block" id="Window.about">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Window.about">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">about</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays the About message box from PyQt.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">about</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="s2">&quot;About Iguape&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&lt;p&gt;This is the Paineira Graphical User Interface&lt;/p&gt;&quot;</span>
            <span class="s2">&quot;&lt;p&gt;- Its usage is resttricted to data acquired via in-situ experiments at Paineira. The software is under the GNU GPL-3.0 License.&lt;/p&gt;&quot;</span>
            <span class="s2">&quot;&lt;p&gt;- There&#39;s a brief tutorial for first time users, which can be helpful, altough the program&#39;s operation is very simple&quot;</span>
            <span class="s2">&quot;&lt;p&gt;- Paineira Beamline&lt;/p&gt;&quot;</span>
            <span class="s2">&quot;&lt;p&gt;- LNLS - CNPEM&lt;/p&gt;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Worker">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Worker">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Worker</span><span class="p">(</span><span class="n">QThread</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    QThread Class for performing the Peak Fit. It emits signals for progress, finished and error.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        interval (list): List with the fitting interval</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">progress</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">finished</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> 
    <span class="n">error</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="c1"># Changed to emit multiple arrays</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_interval</span> <span class="o">=</span> <span class="n">interval</span>
        <span class="n">QApplication</span><span class="o">.</span><span class="n">setOverrideCursor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">WaitCursor</span><span class="p">)</span>

<div class="viewcode-block" id="Worker.run">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.Worker.run">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Peak Fitting routine. It calls the peak_fit or peak_fit_split_gaussian routine based on the selected fitting model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">])):</span>
                <span class="k">if</span> <span class="n">win</span><span class="o">.</span><span class="n">fit_interval_window</span><span class="o">.</span><span class="n">fit_model</span> <span class="o">==</span> <span class="s1">&#39;PseudoVoigt&#39;</span><span class="p">:</span>
                    <span class="n">fit</span> <span class="o">=</span> <span class="n">peak_fit</span><span class="p">(</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_interval</span><span class="p">)</span>
                    <span class="n">new_fit_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;dois_theta_0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">fit</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="s1">&#39;fwhm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">fit</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="s1">&#39;area&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">fit</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="s1">&#39;temp&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span> <span class="s1">&#39;file_index&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;file_index&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span> <span class="s1">&#39;R-squared&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">fit</span><span class="p">[</span><span class="mi">3</span><span class="p">]]})</span>
                    <span class="n">win</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">win</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">,</span> <span class="n">new_fit_data</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">progress_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">progress_value</span><span class="p">)</span>  <span class="c1"># Emit progress signal with percentage</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fit</span> <span class="o">=</span> <span class="n">peak_fit_split_gaussian</span><span class="p">(</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_interval</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">win</span><span class="o">.</span><span class="n">fit_interval_window</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">win</span><span class="o">.</span><span class="n">fit_interval_window</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span>
                    <span class="n">new_fit_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;dois_theta_0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">fit</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span> <span class="s1">&#39;dois_theta_0_#2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">fit</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span> <span class="s1">&#39;fwhm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">fit</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span> <span class="s1">&#39;fwhm_#2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">fit</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span> <span class="s1">&#39;area&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">fit</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span> <span class="s1">&#39;area_#2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">fit</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span> <span class="s1">&#39;temp&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span> <span class="s1">&#39;file_index&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;file_index&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span> <span class="s1">&#39;R-squared&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">fit</span><span class="p">[</span><span class="mi">3</span><span class="p">]]})</span>
                    <span class="n">win</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span> <span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">win</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">fit_data</span><span class="p">,</span> <span class="n">new_fit_data</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
               

                    <span class="n">progress_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">progress_value</span><span class="p">)</span>  <span class="c1"># Emit progress signal with percentage</span>
            <span class="c1">#self.finished.emit(win.monitor.fit_data[&#39;dois_theta_0&#39;], win.monitor.fit_data[&#39;area&#39;], win.monitor.fit_data[&#39;fwhm&#39;])  # Emit finished signal with results</span>
            <span class="n">finish</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">finish</span><span class="o">-</span><span class="n">start</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error during peak fitting: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">. Please select a new Fit Interval&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exception </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">. Please select a new Fit Interval&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="FitWindow">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.FitWindow">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FitWindow</span><span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">Ui_pk_window</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit Window Class. It creates a new window for the Peak Fitting routine. </span>
<span class="sd">    It allows the user to select the fitting model, the fitting interval and the fitting parameters.</span>
<span class="sd">    It inherits the QDialog class from PyQt.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FitWindow.__init__">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.FitWindow.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor for the FitWindow class. It initializes the window and sets up the layout.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            parent (QWidget): Parent widget for the window</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_interval</span><span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_model</span> <span class="o">=</span> <span class="s1">&#39;PseudoVoigt&#39;</span>
        <span class="n">win</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">set_fit_model</span> <span class="o">=</span> <span class="s2">&quot;PseudoVoigt&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="mi">25</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mf">1e+09</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_layout</span><span class="p">()</span></div>


<div class="viewcode-block" id="FitWindow.setup_layout">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.FitWindow.setup_layout">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Routine for setting up the layout of the FitWindow. It creates the Figure and the layout for the Peak Fitting plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Peak Fit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pk_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">win</span><span class="o">.</span><span class="n">plot_with_temp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;XRD pattern &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;°C&#39;</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;XRD pattern #&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;file_index&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;2θ (°)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (u.a.)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">FigureCanvas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pk_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pk_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">NavigationToolbar2QT</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pk_frame</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pk_layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">span</span> <span class="o">=</span> <span class="n">SpanSelector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onselect</span><span class="p">,</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">useblit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">props</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">capstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_plot_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clear_plot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pk_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shade</span> <span class="o">=</span> <span class="kc">False</span>


        <span class="k">if</span> <span class="n">win</span><span class="o">.</span><span class="n">plot_with_temp</span><span class="p">:</span>
            <span class="n">items_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;°C&#39;</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xrd_combo_box</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="n">items_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">items_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;file_index&#39;</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xrd_combo_box</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="n">items_list</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">xrd_combo_box</span><span class="o">.</span><span class="n">activated</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onChanged_xrd_combo_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pk_combo_box</span><span class="o">.</span><span class="n">activated</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onChanged_pk_combo_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bgk_combo_box</span><span class="o">.</span><span class="n">activated</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onChanged_bkg_combo_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preview_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preview</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_spinBox</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_spinBox</span><span class="o">.</span><span class="n">valueChanged</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onChanged_distance_spinbox</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height_spinBox</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height_spinBox</span><span class="o">.</span><span class="n">valueChanged</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onChanged_height_spinbox</span><span class="p">)</span></div>


<div class="viewcode-block" id="FitWindow.onChanged_xrd_combo_box">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.FitWindow.onChanged_xrd_combo_box">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">onChanged_xrd_combo_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Routine for selecting the XRD pattern to be displayed on the plot via the ComboBox.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            text (str): Text selected on the ComboBox</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;Warning! It is possible to display only two XRD patterns in this window! Please press the Clear Plot button and select up to 2 XRD patterns to be displayed.&#39;</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xrd_combo_box</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">win</span><span class="o">.</span><span class="n">plot_with_temp</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;XRD pattern &#39;</span> <span class="o">+</span> <span class="n">text</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;XRD pattern #&#39;</span> <span class="o">+</span> <span class="n">text</span><span class="p">))</span>
        
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;2θ (°)&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (u.a.)&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

    
<div class="viewcode-block" id="FitWindow.onChanged_pk_combo_box">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.FitWindow.onChanged_pk_combo_box">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">onChanged_pk_combo_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Routine for selecting the Peak Fitting Model via the ComboBox.</span>
<span class="sd">        </span>
<span class="sd">        Parameters </span>
<span class="sd">        ----------</span>
<span class="sd">            text (str): Text selected on the ComboBox</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;PseudoVoigt Model&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_model</span> <span class="o">=</span> <span class="s1">&#39;PseudoVoigt&#39;</span>
            <span class="n">win</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">set_fit_model</span> <span class="o">=</span> <span class="s1">&#39;PseudoVoigt&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">distance_spinBox</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height_spinBox</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_model</span> <span class="o">=</span> <span class="s1">&#39;2x PseudoVoigt(SPV)&#39;</span>
            <span class="n">win</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">set_fit_model</span> <span class="o">=</span> <span class="s1">&#39;2x PseudoVoigt(SPV)&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">distance_spinBox</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height_spinBox</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="FitWindow.onChanged_bkg_combo_box">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.FitWindow.onChanged_bkg_combo_box">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">onChanged_bkg_combo_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Routine for selecting the Background Model via the ComboBox.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            text (str): Text selected on the ComboBox</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;Linear Model&#39;</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">bkg_model</span> <span class="o">=</span> <span class="s1">&#39;Linear&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bkg_model</span> <span class="o">=</span> <span class="s1">&#39;Spline&#39;</span></div>


<div class="viewcode-block" id="FitWindow.onselect">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.FitWindow.onselect">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">onselect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Routine for selecting the fitting interval. It updates the fit_interval attribute and the interval_label label.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            xmin (float): Minimum x value of the selected interval</span>
<span class="sd">            xmax (float): Maximum x value of the selected interval</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shade</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shade</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_interval</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[</span><span class="si">{</span><span class="n">xmin</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">xmax</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shade</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Selected Fitting Interval&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

        
<div class="viewcode-block" id="FitWindow.onChanged_distance_spinbox">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.FitWindow.onChanged_distance_spinbox">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">onChanged_distance_spinbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for setting the distance between the two peaks for the Split Pseudo-Voigt Model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            value (int): Value selected on the SpinBox</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="FitWindow.onChanged_height_spinbox">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.FitWindow.onChanged_height_spinbox">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">onChanged_height_spinbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for setting the height for the peak search for the Split Pseudo-Voigt Model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            value (int): Value selected on the SpinBox</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">value</span><span class="o">*</span><span class="p">(</span><span class="mf">1e+09</span><span class="p">)</span></div>

        

<div class="viewcode-block" id="FitWindow.clear_plot">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.FitWindow.clear_plot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">clear_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears the plot on the FitWindow.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>


<div class="viewcode-block" id="FitWindow.preview">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.FitWindow.preview">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">preview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a Preview of the Peak Fitting for the selected Model and 2theta Interval.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_model</span> <span class="o">==</span> <span class="s2">&quot;PseudoVoigt&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">)):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">peak_fit</span><span class="p">(</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_interval</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">win</span><span class="o">.</span><span class="n">plot_with_temp</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">best_fit</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Best Fit - </span><span class="si">{</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s2">&quot;temp&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="si">}</span><span class="s1"> °C&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="s1">&#39;bkg_&#39;</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Background - </span><span class="si">{</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s2">&quot;temp&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="si">}</span><span class="s1"> °C&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">best_fit</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Best Fit - #</span><span class="si">{</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s2">&quot;file_index&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="s1">&#39;bkg_&#39;</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Background - #</span><span class="si">{</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s2">&quot;file_index&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">peak_fit_split_gaussian</span><span class="p">(</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_interval</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">win</span><span class="o">.</span><span class="n">plot_with_temp</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">best_fit</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Best Fit - </span><span class="si">{</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s2">&quot;temp&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="si">}</span><span class="s1"> °C&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="s1">&#39;bkg_&#39;</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Background - </span><span class="si">{</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s2">&quot;temp&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="si">}</span><span class="s1"> °C&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">best_fit</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Best Fit - #</span><span class="si">{</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s2">&quot;file_index&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="s1">&#39;bkg_&#39;</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Background - #</span><span class="si">{</span><span class="n">win</span><span class="o">.</span><span class="n">plot_data</span><span class="p">[</span><span class="s2">&quot;file_index&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">UnboundLocalError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;The value given for distance and/or height for peak search are out of bounds, i.e., it was not possible to find two peaks mtaching the given parameters! Please, try again with different values for distance and height!&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="FitWindow.fit">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.FitWindow.fit">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Routine for starting the Peak Fitting process. It sets the fitting interval, the fitting model, the distance and the height for the Split Pseudo-Voigt Model.</span>
<span class="sd">        It starts the Worker thread for the Peak Fitting process.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">win</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">set_fit_interval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_interval</span><span class="p">)</span>
        <span class="n">win</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">set_distance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span>
        <span class="n">win</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">set_height</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="n">win</span><span class="o">.</span><span class="n">fit_interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_interval</span>
        <span class="n">win</span><span class="o">.</span><span class="n">fit_interval_window</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">progress_dialog</span> <span class="o">=</span> <span class="n">QProgressDialog</span><span class="p">(</span><span class="s2">&quot;Fitting peaks...&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_dialog</span><span class="o">.</span><span class="n">setWindowModality</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">WindowModal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_dialog</span><span class="o">.</span><span class="n">setAutoClose</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_dialog</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_dialog</span><span class="o">.</span><span class="n">setCancelButton</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Start the worker thread for peak fitting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">worker</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_interval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_progress</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peak_fitting_finished</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peak_fitting_error</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>


<div class="viewcode-block" id="FitWindow.update_progress">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.FitWindow.update_progress">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Routine for updating the progress bar on the Peak Fitting process.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            value (int): Value for the progress bar</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">progress_dialog</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="FitWindow.peak_fitting_finished">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.FitWindow.peak_fitting_finished">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">peak_fitting_finished</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Routine for handling the Peak Fitting process completion. It updates the graphs and displays a message box with the elapsed time.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            time (float): Elapsed time for the Peak Fitting process</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">progress_dialog</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Peak Fitting&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Peak fitting completed successfully! Elapsed time: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">)</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
        <span class="n">win</span><span class="o">.</span><span class="n">update_graphs</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="FitWindow.peak_fitting_error">
<a class="viewcode-back" href="../../Iguape.html#Iguape.iguape.FitWindow.peak_fitting_error">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">peak_fitting_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Routine for handling the Peak Fitting process error. It displays a message box with the error message.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            error_message (str): Error message for the Peak Fitting process</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_dialog</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Peak Fitting Error&quot;</span><span class="p">,</span> <span class="n">error_message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>
</div>


        

        


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">win</span> <span class="o">=</span> <span class="n">Window</span><span class="p">()</span>
    <span class="n">win</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec</span><span class="p">())</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, João Luis Biondo Neto; Junior Cintra Mauricio; Cristiane Barbieri Rodella.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>